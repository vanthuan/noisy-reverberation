function [ F, J ] = fujimodelLombardALL( x, t,y )
%FUJIMODELLOMBARD Summary of this function goes here
%   Detailed explanation goes here

F =  x(1) + x(2)* x(3).^2.*(t-x(6)) .* exp(-x(3).*(t-x(6))) .*(t-x(6) >=0) + ...
          x(5)*(min(1- (1 + x(4).*(t-x(7))).*exp(-x(4).*(t-x(7))),0.9).*(t-x(7) >= 0) - ...
          min(1- (1 + x(4).*(t-x(8))).*exp(-x(4).*(t-x(8))),0.9).*(t-x(8) >= 0)) - y;
             
if nargout > 1
    N = length(t);
    k = 1:N;
    J = zeros(N,8);
    J(k,1) = 1; % Fb
    J(k,2) =  x(3).^2.*(t-x(6)) .* exp(-x(3).*(t-x(6))) .*(t-x(6) >=0); % Ap
    J(k,3) = x(2).*(t-x(6)).* x(3).*exp(-x(3).*(t-x(6))) .* (2 - x(3) .*(t- x(6))) .* (t-x(6) >=0); % alpha
    % (2*x(3)*x(2).*(t-x(6)) .* exp(-x(3).*(t-x(6))) - x(3).^2.*x(2).*(t-x(6)).^2.* exp(-x(3).*(t-x(6)))).*(t-x(6) >=0);
%      J(k,4) =    x(5)*(-(t-x(7)).*exp(-x(4).*(t-x(7))) + (1+ x(4).*(t-x(7))).*(t-x(7)).*exp(-x(4).*(t-x(7)))).*(1- (1 + x(4).*(t-x(7))).*exp(-x(4).*(t-x(7))) <= 0.9).*(t-x(7) >= 0) + ...
%                  x(5)*(-(t-x(8)).*exp(-x(4).*(t-x(8))) + (1+  x(4).*(t-x(8))).*(t-x(8)).*exp(-x(4).*(t-x(8)))).*(1- (1 + x(4).*(t-x(8))).*exp(-x(4).*(t-x(8))) <= 0.9).*(t-x(8) >= 0);
% %     
    J(k,4) = x(5) .*x(4).*(t-x(7)).^2.* exp(-x(4).*(t-x(7))).*(1- (1 + x(4).*(t-x(7))).*exp(-x(4).*(t-x(7))) <= 0.9).*(t-x(7) >= 0) - ...
        x(5) .*x(4).*(t-x(8)).^2.* exp(-x(4).*(t-x(8))).*(1- (1 + x(4).*(t-x(8))).*exp(-x(4).*(t-x(8))) <= 0.9).*(t-x(8) >= 0);  % beta
                
    J(k,5) = min(1- (1 + x(4).*(t-x(7))).*exp(-x(4).*(t-x(7))),0.9).*(t-x(7) >= 0) - min(1- (1 + x(4).*(t-x(8))).*exp(-x(4).*(t-x(8))),0.9).*(t-x(8) >= 0); % Aa
%     J(k,6) = (x(2)* x(3).^2.*(-1) .* exp(-x(3).*(t-x(6))) + x(2)* x(3).^3.*(t-x(6)) .* exp(-x(3).*(t-x(6))) ) .*(t-x(6) >=0) ;
    J(k,6) = x(2).*x(3).^2.* exp(-x(3).*(t-x(6))).*((t-x(6)).*x(3) - 1) .*(t-x(6) >=0) ; % T0

    J(k,7) = x(5)*( x(4)*exp(-x(4).*(t-x(7))).*(1- (1 + x(4) *(t- x(7))))).*(1- (1 + x(4).*(t-x(7))).*exp(-x(4).*(t-x(7))) <= 0.9).*(t-x(7) >= 0) ;% T1
    J(k,8) = -x(5)*( x(4)*exp(-x(4).*(t-x(8))).*(1- (1 + x(4) *(t- x(8))))).*(1- (1 + x(4).*(t-x(8))).*exp(-x(4).*(t-x(8))) <= 0.9).*(t-x(8) >= 0) ; % T2

end

end

